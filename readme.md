Извлечение данных из текстов законов о бюджете Санкт-Петербурга
===============================================================

Результаты находятся [здесь](http://antonkhorev.github.io/BudgetSpb/).

Зачем?
------

Законы о бюджете публикуются в виде pdf-файлов, основную часть которых составляют таблицы с данными, занимающие сотни страниц.
Есть ещё вариант — весь текст закона из системы «Кодекс» на одной очень большой странице html или в одном doc-файле.
Таблицы оттуда для удобства работы с ними можно было бы извлечь, что данная программа и делает.
На данный момент обрабатывается *Ведомственная структура расходов*, которая обычно находится в приложениях 3 и 4 к закону.

Как запустить?
--------------

1. Установить:
1.1. [python 3](http://www.python.org/) (проверено с версией 3.3);
1.2. [xlwt3](https://bitbucket.org/luensdorf/xlwt3) — так как `xlwt` под python 3 не портирована, нужен `xlwt3`,
     но `xlwt3` не поддерживается автором и не заработает под python 3.3, поэтому нужен её указанный форк;
1.3. [PyYAML](http://pyyaml.org/wiki/PyYAML) (проверено с версией 3.10);
1.4. скачать [pdfbox-app-1.8.1.jar](http://pdfbox.apache.org/downloads.html), положить в каталог `bin`.
2. Запустить `src/main.py`, который скачает файлы с текстами законов, создаст csv и xls с таблицами и `index.html` со ссылками на созданные файлы.
2.1. *Если нужно скачать законы вручную:*
     ссылки на них есть в [таблице с документами](http://antonkhorev.github.io/BudgetSpb/), столбец «исходные документы в pdf», ссылка «архив»,
     Некоторых архивов нет на сайте Комитета финансов, соответственно, нет и ссылок на них.
     В этом случае нужно перейти по ссылке «страница» и скачать все файлы закона по отдельности.
2.2. *Если нужно найти их на сайте Комитета финансов:*
     ссылки на них находятся на странице [«Законы о бюджете»](http://www.fincom.spb.ru/comfin/budjet/laws.htm).
     Нужен файл, где весь закон с приложениями — он называется обычно «Скачать Закон с приложениями», «Текст проекта Закона с приложениями» или «Скачать все».
     Если его нет, нужно скачать все файлы закона по отдельности.
2.3. *Вручную скачиваемые файлы* нужно класть в подкаталог каталога `zip`, соответствующий ссылке.
     Например, файл `http://www.fincom.spb.ru/files/cf/npd/budget/2013/full/bd2013-15.zip` должен находиться в каталоге `zip/2013/full`.
3. *Далее — только для публикации в интернете:*
   Закачать каталоги `csv` и `xls` на хостинг файлов (проверено на *dropbox*).
4. Средствами хостинга сделать их общедоступными.
5. Сохранить html-страницы с ссылками на файлы в каталог `htm`.
6. Запустить `src/linker.py`, который сделает новый `index.html` со ссылками на файлы на хостинге.
7. Закачать `index.html` на веб-хостинг (проверено на *github pages*, на *dropbox* не сработает).
